
$(function(){var y=new Array();var L=$("#q");var n=$("#formCaptionLabel");var h=$("#personForm");var J=$("#termsModal");var A=$("#personCode");var r=$("#firstName");var a=$("#lastName");var P=$("#birthDay");var H=$("#birthMonth");var C=$("#birthYear");var o=$("#idTypeCode");var T=$("#idDocNum");var s=$("#email");var i=$("#phone");var Q=$("#gender");var d=$("#countryDropdown");var N=$("#authonomyDropdown");var F=$("#provinceDropdown");var S=$("#addressGroup");var G=$("#countryCode");var v=$("#authonomyCode");var l=$("#provinceCode");var M=$("#address");var m=$("#city");var x=$("#postCode");var D=$("#notifications");var B=$("#terms");var t=$("#tAndC");var I=$("#btnProcessForm");I.on("click",k);t.on("click",e);G.on("change",c);v.on("change",w);l.on("change",z);u();function u(){j(A.val());O()}function j(q){$.get(("fiAPI/0.0/ops/persons/"+L.val()+"/"+q),R)}function R(W){A.val(W.personCode);o.val(W.personIdTypeCode);T.val(W.personIdNumber);r.val(W.personFirstName);a.val(W.personLastName);P.val((W.birthDay!==0)?W.birthDay:0);H.val((W.birthMonth!==0)?W.birthMonth:0);C.val((W.birthYear!==0)?W.birthYear:0);s.val(W.email);i.val(W.phone);$('input:radio[name="gender"][value="'+W.genderCode+'"]').attr("checked",true);var V=(W.countryCode!==0)?W.countryCode:64;W.countryCode=V;var q=(W.authonomyCode!==0)?W.authonomyCode:13;W.authonomyCode=q;var U=(W.provinceCode!==0)?W.provinceCode:44;W.provinceCode=U;M.val(W.postalAddress);m.val(W.city);x.val(W.postCode);$.each(W.prefs,function(){$("#pref_"+this.preferenceCode).prop("checked",true)});b(W)}function k(){var V={};V.personCode=A.val();V.personIdTypeCode=o.val();V.personIdNumber=T.val();V.personFirstName=r.val();V.personLastName=a.val();V.birthDay=P.val();V.birthMonth=H.val();V.birthYear=C.val();V.email=s.val();V.phone=i.val();V.genderCode=$('input:radio[name="gender"]:checked').val();V.countryCode=G.val();V.authonomyCode=v.val();V.provinceCode=l.val();V.postalAddress=M.val();V.city=m.val();V.postCode=x.val();V.receiveNews=D.is(":checked");V.acceptTerms=B.is(":checked");var q=new Array();$('input[name="preferences"]:checked').each(function(){var W={};W.preferenceCode=$(this).val();q.push(W)});V.prefs=q;var U=JSON.stringify(V);$.ajax({url:"fiAPI/0.0/ops/persons/"+L.val(),method:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:U,success:function(W){K(W)},error:function(Y,W,X){alert("ERROR: "+X+" STATUS: "+W)}})}function e(){J.modal("show")}function b(q){if(q.countryCode>0){p(q.countryCode,q.authonomyCode);N.show()}else{N.hide()}if(q.authonomyCode>0){g(q.authonomyCode,q.provinceCode);F.show()}else{F.hide()}if(q.provinceCode>0){S.show()}else{S.hide()}}function p(U,q){$.get(("fiAPI/0.0/geo/authonomiesHtml/"+L.val()+"/"+U),function(V){v.html(V);v.val(q)})}function g(q,U){$.get(("fiAPI/0.0/geo/provincesHtml/"+L.val()+"/"+q),function(V){l.html(V);l.val(U)})}function c(){if(G.val()==="0"){N.hide();v.val("0");F.hide();l.val("0");S.hide()}else{p(G.val(),v.val());N.show();F.hide();S.hide()}}function w(){if(v.val()==="0"){F.hide();l.val("0");S.hide()}else{g(v.val(),l.val());F.show();S.hide()}}function z(){if(l.val()==="0"){S.hide()}else{S.show()}}reset=function(){$("toggleCSS").href="css/alertify.core.css";alertify.set({labels:{ok:"OK",cancel:"Cancel"},delay:3000,buttonReverse:false,buttonFocus:"ok"})};function K(q){f();if(q.issues.length>0){E(q);reset();alertify.error(q.status.issueMessage)}else{reset();alertify.success(q.status.issueMessage);setInterval(function(){window.location.replace(q.navTo+"?q="+L.val())},3500)}}function O(){y.push("idDocument");y.push("firstName");y.push("lastName");y.push("birthdate");y.push("idNumber");y.push("email");y.push("phone");y.push("gender");y.push("country");y.push("authonomy");y.push("province");y.push("address");y.push("city");y.push("postCode");y.push("terms")}function f(){for(var q=0;q<y.length;q++){$("#"+y[q]+"_val").removeClass("has-error");$("#"+y[q]+"_issues").html("");$("#"+y[q]+"_issues").hide()}}function E(q){$("#"+q.issues[0].issueID+"_val").scrollIntoView();for(var U=0;U<q.issues.length;U++){$("#"+q.issues[U].issueID+"_val").addClass("has-error");$("#"+q.issues[U].issueID+"_issues").html(q.issues[U].issueMessage);$("#"+q.issues[U].issueID+"_issues").show()}}});