
$(function(){var l=$("#numPieces");var o=$("#baseTime");var t=$("#dimension");var c=$("#simParamsForm");var n=$("#btnProcessForm");var v=$("#simTablePane");var i=$("#simulationTable");var p;var f;n.on("click",k);t.on("change",u);$("#simulationTable tbody").on("click","tr",r);var g;b();function b(){l.val(6);o.val(12);t.val(2)}function k(){var x={};x.numPieces=l.val();x.baseTime=o.val();x.dimension=t.val();var y=JSON.stringify(x);$.ajax({url:"adsAPI/1.0/sim/adsSimulation",method:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:y,success:function(z){s(z.aaData)},error:function(B,z,A){alert("ERROR: "+A+" STATUS: "+z)}})}function s(A){f=A;var x=[];for(var y=0;y<A.length;y++){var z=[];z.push(A[y].pieceName);z.push(A[y].assignedTime);z.push(A[y].printNumber);z.push(A[y].exposureTime);z.push(A[y].timeframe);x.push(z)}if(g!==undefined){g.destroy()}g=i.DataTable({data:x,columns:[{title:"Pieza"},{title:"Tiempo por Impresi&oacute;n"},{title:"Total Impresiones"},{title:"Tiempo Exposici&oacute;n"}]});v.show()}var q=false;function r(){var x=$(this);p={};p.piece=(g.row(x).data())[0];p.time=(g.row(x).data())[1];q=false;w(p)}function w(x){if(q===false){bootbox.prompt({title:"Ingrese el tiempo deseado para la pieza: '"+x.piece+":",value:x.time,callback:function(y){if(y===null){}else{if(isNaN(y)){alert("El valor introducido no es un n\372mero v\341lido.")}else{x.newTime=parseInt(y);h(x);q=true}}}})}}var e=45000;var a=7*e;var d=28*e;function m(x){var y=0;switch(x){case 1:y=e;break;case 2:y=a;break;case 3:y=d;break}return y}function h(y){for(var x=0;x<f.length;x++){if(f[x].pieceName===y.piece&&f[x].assignedTime===y.time){f[x].assignedTime=y.newTime;y.newTime=undefined}}u()}function u(){for(var y=0;y<f.length;y++){f[y].printNumber=0;f[y].exposureTime=""}var x=m(parseInt(t.val()));var z=true;while(z){for(var y=0;y<f.length;y++){if(x>=f[y].assignedTime){f[y].printNumber=(f[y].printNumber+1);x=x-f[y].assignedTime}else{z=false}}}for(var y=0;y<f.length;y++){f[y].exposureTime=j(f[y].printNumber*f[y].assignedTime)}s(f)}function j(z){var x=Math.floor(z/3600);var y=Math.floor((z-(x*3600))/60);var A=z-(x*3600)-(y*60);if(x<10){x="0"+x}if(y<10){y="0"+y}if(A<10){A="0"+A}return(x+" h "+y+" m "+A+" s")}});